<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MailGuard ‚Äî Phishing Detector</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #f4f6fb;
      --white: #ffffff;
      --ink: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --accent: #4f46e5;
      --accent-hover: #4338ca;
      --accent-light: #eef2ff;
      --danger: #dc2626;
      --danger-bg: #fef2f2;
      --danger-border: #fecaca;
      --warning: #d97706;
      --warning-bg: #fffbeb;
      --warning-border: #fde68a;
      --safe: #16a34a;
      --safe-bg: #f0fdf4;
      --safe-border: #bbf7d0;
      --serif: 'DM Serif Display', Georgia, serif;
      --sans: 'DM Sans', sans-serif;
      --shadow-card: 0 2px 4px rgba(0,0,0,0.04), 0 8px 32px rgba(0,0,0,0.08);
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--ink);
      font-family: var(--sans);
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav {
      background: var(--white);
      border-bottom: 1px solid var(--border);
      padding: 0 32px;
      position: sticky; top: 0; z-index: 100;
    }

    .nav-inner {
      max-width: 1100px; margin: 0 auto;
      height: 62px; display: flex;
      align-items: center; justify-content: space-between;
    }

    .logo {
      display: flex; align-items: center; gap: 10px;
      text-decoration: none;
    }

    .logo-icon {
      width: 34px; height: 34px; border-radius: 8px;
      background: var(--accent);
      display: flex; align-items: center; justify-content: center;
    }

    .logo-icon svg { color: white; }

    .logo-name {
      font-family: var(--serif); font-size: 20px; color: var(--ink);
    }

    .nav-right { display: flex; align-items: center; gap: 12px; }

    .nav-link {
      font-size: 14px; font-weight: 500; color: var(--muted);
      text-decoration: none; padding: 6px 12px; border-radius: 6px;
      transition: color 0.15s;
    }

    .nav-link:hover { color: var(--ink); }

    .nav-btn {
      font-size: 14px; font-weight: 600; color: white;
      text-decoration: none; padding: 8px 18px;
      background: var(--accent); border-radius: 8px;
      transition: background 0.15s;
    }

    .nav-btn:hover { background: var(--accent-hover); }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      text-align: center;
      padding: 64px 24px 40px;
      opacity: 0; animation: fadeUp 0.6s 0.05s ease forwards;
    }

    .hero-pill {
      display: inline-flex; align-items: center; gap: 7px;
      background: var(--accent-light); color: var(--accent);
      font-size: 13px; font-weight: 600;
      padding: 5px 16px; border-radius: 100px;
      margin-bottom: 20px; letter-spacing: 0.01em;
    }

    .hero-pill span {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--accent); animation: blink 2s infinite;
    }

    .hero h1 {
      font-family: var(--serif);
      font-size: clamp(32px, 5vw, 48px);
      font-weight: 400; color: var(--ink);
      line-height: 1.2; margin-bottom: 16px;
    }

    .hero h1 em { font-style: italic; color: var(--accent); }

    .hero p {
      font-size: 17px; color: var(--muted);
      max-width: 520px; margin: 0 auto 12px;
      font-weight: 300; line-height: 1.7;
    }

    .hero-badges {
      display: flex; justify-content: center;
      flex-wrap: wrap; gap: 20px; margin-top: 20px;
    }

    .badge-item {
      display: flex; align-items: center; gap: 6px;
      font-size: 13px; color: var(--muted); font-weight: 500;
    }

    .badge-item svg { color: var(--safe); }

    /* ‚îÄ‚îÄ MAIN TOOL ‚îÄ‚îÄ */
    .tool-wrap {
      max-width: 900px; margin: 0 auto; padding: 0 24px 64px;
      opacity: 0; animation: fadeUp 0.6s 0.15s ease forwards;
    }

    .tool-card {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow-card);
      overflow: hidden;
    }

    /* Top bar */
    .tool-topbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      background: #fafafa;
    }

    .tool-topbar-left {
      font-size: 13px; font-weight: 600; color: var(--muted);
      display: flex; align-items: center; gap: 8px;
    }

    .tool-topbar-left svg { color: var(--accent); }

    .char-count { font-size: 12px; color: #9ca3af; font-weight: 400; }

    .clear-btn {
      font-size: 13px; color: var(--muted); background: none;
      border: none; cursor: pointer; padding: 4px 10px;
      border-radius: 6px; transition: all 0.15s; font-family: var(--sans);
    }

    .clear-btn:hover { background: var(--border); color: var(--ink); }

    /* Textarea */
    .paste-area {
      width: 100%; min-height: 260px;
      padding: 24px 28px;
      font-family: var(--sans); font-size: 15px;
      color: var(--ink); line-height: 1.7;
      border: none; outline: none; resize: none;
      background: var(--white);
    }

    .paste-area::placeholder { color: #c4c9d4; }

    /* Bottom bar */
    .tool-bottombar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      background: #fafafa;
      flex-wrap: wrap; gap: 12px;
    }

    .engine-tags {
      display: flex; flex-wrap: wrap; gap: 6px;
    }

    .engine-tag {
      font-size: 11px; font-weight: 600; color: var(--muted);
      background: var(--border); padding: 3px 10px;
      border-radius: 100px; letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .scan-btn {
      display: flex; align-items: center; gap: 8px;
      padding: 12px 28px; background: var(--accent);
      color: white; border: none; border-radius: 10px;
      font-family: var(--sans); font-size: 15px; font-weight: 600;
      cursor: pointer; transition: all 0.2s;
      white-space: nowrap;
    }

    .scan-btn:hover:not(:disabled) {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(79,70,229,0.35);
    }

    .scan-btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none; box-shadow: none; }

    /* ‚îÄ‚îÄ RESULT ‚îÄ‚îÄ */
    .result-wrap {
      max-width: 900px; margin: 0 auto; padding: 0 24px;
      display: none;
    }

    .result-wrap.visible {
      display: block; animation: fadeUp 0.4s ease forwards;
    }

    /* Scanning bar */
    .scanning-bar {
      display: none; align-items: center; gap: 14px;
      padding: 18px 24px; margin-bottom: 16px;
      background: var(--accent-light);
      border: 1px solid rgba(79,70,229,0.15);
      border-radius: 12px;
      font-size: 14px; color: var(--accent); font-weight: 500;
    }

    .scanning-bar.active { display: flex; }

    .spinner {
      width: 20px; height: 20px; flex-shrink: 0;
      border: 2.5px solid rgba(79,70,229,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
    }

    .scan-steps { display: flex; flex-direction: column; gap: 2px; }
    .scan-step { font-size: 12px; color: rgba(79,70,229,0.7); }

    /* Verdict */
    .verdict-box {
      border-radius: 14px; padding: 24px 28px;
      display: flex; align-items: flex-start; gap: 18px;
      margin-bottom: 16px; border: 1.5px solid;
    }

    .verdict-box.PHISHING { background: var(--danger-bg); border-color: var(--danger-border); }
    .verdict-box.SUSPICIOUS { background: var(--warning-bg); border-color: var(--warning-border); }
    .verdict-box.SAFE { background: var(--safe-bg); border-color: var(--safe-border); }

    .verdict-emoji { font-size: 40px; line-height: 1; flex-shrink: 0; margin-top: 2px; }

    .verdict-right {}

    .verdict-heading {
      font-family: var(--serif); font-size: 26px;
      font-weight: 400; margin-bottom: 4px;
    }

    .verdict-box.PHISHING .verdict-heading { color: var(--danger); }
    .verdict-box.SUSPICIOUS .verdict-heading { color: var(--warning); }
    .verdict-box.SAFE .verdict-heading { color: var(--safe); }

    .verdict-sub { font-size: 14px; color: var(--muted); line-height: 1.6; }

    /* Breakdown */
    .breakdown-card {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 32px;
      box-shadow: var(--shadow-card);
    }

    .breakdown-header {
      padding: 14px 24px;
      background: #fafafa;
      border-bottom: 1px solid var(--border);
      font-size: 12px; font-weight: 700;
      color: var(--muted); letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .check-item {
      display: flex; align-items: center; gap: 14px;
      padding: 14px 24px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }

    .check-item:last-child { border-bottom: none; }

    .check-dot {
      width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0;
    }

    .check-dot.PHISHING { background: var(--danger); box-shadow: 0 0 0 3px rgba(220,38,38,0.15); }
    .check-dot.SUSPICIOUS { background: var(--warning); box-shadow: 0 0 0 3px rgba(217,119,6,0.15); }
    .check-dot.SAFE { background: var(--safe); box-shadow: 0 0 0 3px rgba(22,163,74,0.15); }
    .check-dot.UNKNOWN { background: var(--border); }

    .check-text { flex: 1; color: var(--ink); line-height: 1.5; }
    .check-text small { display: block; color: var(--muted); font-size: 12px; margin-top: 2px; }

    .check-badge {
      font-size: 11px; font-weight: 700;
      padding: 3px 10px; border-radius: 100px;
      text-transform: uppercase; letter-spacing: 0.04em; flex-shrink: 0;
    }

    .check-badge.PHISHING { background: var(--danger-bg); color: var(--danger); }
    .check-badge.SUSPICIOUS { background: var(--warning-bg); color: var(--warning); }
    .check-badge.SAFE { background: var(--safe-bg); color: var(--safe); }
    .check-badge.UNKNOWN { background: var(--border); color: var(--muted); }

    /* Error */
    .error-bar {
      display: none; align-items: center; gap: 10px;
      padding: 14px 20px; margin-bottom: 16px;
      background: var(--danger-bg);
      border: 1px solid var(--danger-border);
      border-radius: 10px; font-size: 14px; color: var(--danger);
    }

    .error-bar.active { display: flex; }

    /* ‚îÄ‚îÄ NEWSLETTER ‚îÄ‚îÄ */
    .newsletter-wrap {
      max-width: 900px; margin: 0 auto; padding: 0 24px 80px;
      opacity: 0; animation: fadeUp 0.6s 0.3s ease forwards;
    }

    .newsletter-card {
      background: var(--ink); border-radius: 16px;
      padding: 52px 56px;
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 52px; align-items: center;
    }

    @media (max-width: 680px) {
      .newsletter-card { grid-template-columns: 1fr; padding: 36px 28px; gap: 28px; }
    }

    .nl-left h2 {
      font-family: var(--serif); font-size: 28px;
      color: white; font-weight: 400; line-height: 1.3; margin-bottom: 12px;
    }

    .nl-left p { font-size: 15px; color: rgba(255,255,255,0.5); line-height: 1.7; }

    .nl-form { display: flex; flex-direction: column; gap: 10px; }

    .nl-input {
      width: 100%; padding: 12px 16px;
      background: rgba(255,255,255,0.08);
      border: 1.5px solid rgba(255,255,255,0.12);
      border-radius: 8px; color: white;
      font-family: var(--sans); font-size: 15px; outline: none;
      transition: border-color 0.2s;
    }

    .nl-input::placeholder { color: rgba(255,255,255,0.3); }
    .nl-input:focus { border-color: rgba(255,255,255,0.4); }

    .nl-btn {
      width: 100%; padding: 14px;
      background: white; color: var(--ink);
      border: none; border-radius: 8px;
      font-family: var(--sans); font-size: 15px; font-weight: 600;
      cursor: pointer; transition: all 0.2s;
    }

    .nl-btn:hover { background: #f0f0f0; transform: translateY(-1px); }

    .nl-note { font-size: 12px; color: rgba(255,255,255,0.3); text-align: center; }

    .nl-success { display: none; text-align: center; color: white; }
    .nl-success.active { display: block; }

    /* Footer */
    footer {
      text-align: center; padding: 28px 24px;
      font-size: 13px; color: var(--muted);
      border-top: 1px solid var(--border);
    }

    footer a { color: var(--accent); text-decoration: none; }

    /* Animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    @media (max-width: 600px) {
      .tool-bottombar { flex-direction: column; align-items: stretch; }
      .scan-btn { justify-content: center; }
      .engine-tags { display: none; }
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav>
    <div class="nav-inner">
      <a href="#" class="logo">
        <div class="logo-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        </div>
        <span class="logo-name">MailGuard</span>
      </a>
      <div class="nav-right">
        <a href="#how" class="nav-link">How it works</a>
        <a href="#newsletter" class="nav-btn">Stay Protected</a>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <div class="hero">
    <div class="hero-pill"><span></span>Free ¬∑ No Login Required</div>
    <h1>Paste any email.<br/>Know if it's <em>phishing</em>.</h1>
    <p>Our AI cross-checks every email against 5 global threat intelligence databases in seconds.</p>
    <div class="hero-badges">
      <div class="badge-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        VirusTotal
      </div>
      <div class="badge-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Google Safe Browsing
      </div>
      <div class="badge-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        AlienVault OTX
      </div>
      <div class="badge-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        AbuseIPDB
      </div>
      <div class="badge-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Typosquatting Detection
      </div>
    </div>
  </div>

  <!-- TOOL -->
  <div class="tool-wrap">
    <div class="tool-card">
      <div class="tool-topbar">
        <div class="tool-topbar-left">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
          Paste your email here
          <span class="char-count" id="charCount">0 characters</span>
        </div>
        <button class="clear-btn" onclick="clearAll()">Clear</button>
      </div>

      <textarea
        class="paste-area"
        id="emailPaste"
        placeholder="Paste the full email here ‚Äî including From, Subject, and body. For example:

From: security@paypa1.com
Subject: Urgent: Your account has been suspended
Date: Mon, 25 Feb 2026

Dear Customer,

Your account has been temporarily suspended. Please verify your identity immediately by clicking the link below:

http://verify-account-now.ru/login

Failure to verify within 24 hours will result in permanent account closure.

‚Äî PayPal Security Team"
        oninput="onInput()"
      ></textarea>

      <div class="tool-bottombar">
        <div class="engine-tags">
          <span class="engine-tag">VirusTotal</span>
          <span class="engine-tag">SafeBrowsing</span>
          <span class="engine-tag">AlienVault</span>
          <span class="engine-tag">AbuseIPDB</span>
          <span class="engine-tag">Typosquatting</span>
        </div>
        <button class="scan-btn" id="scanBtn" onclick="analyze()" disabled>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          Check for Phishing
        </button>
      </div>
    </div>
  </div>

  <!-- RESULT -->
  <div class="result-wrap" id="resultWrap">

    <div class="scanning-bar" id="scanningBar">
      <div class="spinner"></div>
      <div class="scan-steps">
        <div style="font-size:14px;font-weight:600;">Scanning your email‚Ä¶</div>
        <div class="scan-step">Checking URLs ¬∑ Verifying sender domain ¬∑ Cross-referencing threat databases</div>
      </div>
    </div>

    <div class="error-bar" id="errorBar">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      <span id="errorText"></span>
    </div>

    <div class="verdict-box" id="verdictBox" style="display:none">
      <div class="verdict-emoji" id="verdictEmoji"></div>
      <div class="verdict-right">
        <div class="verdict-heading" id="verdictHeading"></div>
        <div class="verdict-sub" id="verdictSub"></div>
      </div>
    </div>

    <div class="breakdown-card" id="breakdownCard" style="display:none">
      <div class="breakdown-header">Detection Breakdown</div>
      <div id="checksList"></div>
    </div>

  </div>

  <!-- HOW IT WORKS -->
  <div style="max-width:900px;margin:0 auto;padding:0 24px 64px;" id="how">
    <div style="text-align:center;margin-bottom:40px;">
      <div style="font-size:12px;font-weight:700;color:var(--muted);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:12px;">How it works</div>
      <div style="font-family:var(--serif);font-size:32px;font-weight:400;color:var(--ink);">Simple as copy and paste</div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;">
      <div style="background:var(--white);border:1px solid var(--border);border-radius:14px;padding:28px;box-shadow:0 1px 3px rgba(0,0,0,0.04)">
        <div style="width:38px;height:38px;border-radius:10px;background:var(--accent-light);color:var(--accent);font-size:16px;font-weight:700;display:flex;align-items:center;justify-content:center;margin-bottom:16px;">1</div>
        <div style="font-family:var(--serif);font-size:18px;font-weight:400;margin-bottom:8px;">Copy the email</div>
        <div style="font-size:14px;color:var(--muted);line-height:1.6;">Select everything in the suspicious email ‚Äî sender, subject, and body ‚Äî and copy it.</div>
      </div>
      <div style="background:var(--white);border:1px solid var(--border);border-radius:14px;padding:28px;box-shadow:0 1px 3px rgba(0,0,0,0.04)">
        <div style="width:38px;height:38px;border-radius:10px;background:var(--accent-light);color:var(--accent);font-size:16px;font-weight:700;display:flex;align-items:center;justify-content:center;margin-bottom:16px;">2</div>
        <div style="font-family:var(--serif);font-size:18px;font-weight:400;margin-bottom:8px;">Paste and click</div>
        <div style="font-size:14px;color:var(--muted);line-height:1.6;">Paste it into the box above and hit "Check for Phishing". That's all you need to do.</div>
      </div>
      <div style="background:var(--white);border:1px solid var(--border);border-radius:14px;padding:28px;box-shadow:0 1px 3px rgba(0,0,0,0.04)">
        <div style="width:38px;height:38px;border-radius:10px;background:var(--accent-light);color:var(--accent);font-size:16px;font-weight:700;display:flex;align-items:center;justify-content:center;margin-bottom:16px;">3</div>
        <div style="font-family:var(--serif);font-size:18px;font-weight:400;margin-bottom:8px;">Get the verdict</div>
        <div style="font-size:14px;color:var(--muted);line-height:1.6;">We instantly tell you if it's Safe, Suspicious, or a Phishing attempt ‚Äî with a full breakdown.</div>
      </div>
    </div>
  </div>

  <!-- NEWSLETTER -->
  <div class="newsletter-wrap" id="newsletter">
    <div class="newsletter-card">
      <div class="nl-left">
        <h2>Stay ahead of the scammers.</h2>
        <p>Get a weekly digest of the latest phishing tactics, real-world examples, and how to spot them ‚Äî before they hit your inbox.</p>
      </div>
      <div>
        <div class="nl-form" id="nlForm">
          <input class="nl-input" type="text" id="nlName" placeholder="First name"/>
          <input class="nl-input" type="email" id="nlEmail" placeholder="Your email address"/>
          <button class="nl-btn" onclick="subscribe()">Send Me the Weekly Digest ‚Üí</button>
          <p class="nl-note">No spam ¬∑ Unsubscribe anytime</p>
        </div>
        <div class="nl-success" id="nlSuccess">
          <div style="font-size:36px;margin-bottom:12px;">‚úÖ</div>
          <div style="font-size:18px;font-weight:600;color:white;margin-bottom:6px;">You're in!</div>
          <div style="font-size:14px;color:rgba(255,255,255,0.5);">First edition coming your way soon.</div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Made with ‚ù§Ô∏è by a junior dev who refused to give up &nbsp;¬∑&nbsp;
    <a href="http://35.241.196.133:3000" target="_blank">API</a>
  </footer>

  <script>
    const API = 'http://35.241.196.133:3000/phishing/analyze';

    function onInput() {
      const val = document.getElementById('emailPaste').value;
      document.getElementById('charCount').textContent = `${val.length} characters`;
      document.getElementById('scanBtn').disabled = val.trim().length < 10;
    }

    function clearAll() {
      document.getElementById('emailPaste').value = '';
      document.getElementById('charCount').textContent = '0 characters';
      document.getElementById('scanBtn').disabled = true;
      document.getElementById('resultWrap').classList.remove('visible');
      document.getElementById('verdictBox').style.display = 'none';
      document.getElementById('breakdownCard').style.display = 'none';
      document.getElementById('errorBar').classList.remove('active');
    }

    // Parse raw pasted email text into fields
    function parseEmail(raw) {
      const lines = raw.split('\n');
      let sender = '', subject = '', body = '';
      let bodyStart = false;
      let headersDone = false;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        if (!headersDone) {
          if (/^from:/i.test(line)) {
            sender = line.replace(/^from:\s*/i, '').trim();
          } else if (/^subject:/i.test(line)) {
            subject = line.replace(/^subject:\s*/i, '').trim();
          } else if (line.trim() === '' && (sender || subject)) {
            headersDone = true;
          }
        } else {
          body += line + '\n';
        }
      }

      // Fallback: if no headers detected, treat everything as body
      if (!sender && !subject) {
        body = raw;
        // Try extracting email address from anywhere
        const emailMatch = raw.match(/[\w.-]+@[\w.-]+\.\w+/);
        if (emailMatch) sender = emailMatch[0];
      }

      return { sender: sender || 'unknown@unknown.com', subject, body: body.trim() || raw };
    }

    async function analyze() {
      const raw = document.getElementById('emailPaste').value.trim();
      if (!raw) return;

      const { sender, subject, body } = parseEmail(raw);

      const btn = document.getElementById('scanBtn');
      const scanBar = document.getElementById('scanningBar');
      const errorBar = document.getElementById('errorBar');
      const resultWrap = document.getElementById('resultWrap');

      btn.disabled = true;
      scanBar.classList.add('active');
      errorBar.classList.remove('active');
      document.getElementById('verdictBox').style.display = 'none';
      document.getElementById('breakdownCard').style.display = 'none';
      resultWrap.classList.add('visible');

      resultWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });

      try {
        const res = await fetch(API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sender, subject, body })
        });

        if (!res.ok) throw new Error(`Server error ${res.status}`);
        renderResult(await res.json());
      } catch (err) {
        document.getElementById('errorText').textContent = `Something went wrong: ${err.message}. Please try again.`;
        errorBar.classList.add('active');
      } finally {
        btn.disabled = false;
        scanBar.classList.remove('active');
        onInput();
      }
    }

    function renderResult(data) {
      const v = data.verdict;
      const map = {
        PHISHING: { emoji: 'üö®', heading: 'Phishing Detected', sub: 'This email shows clear signs of a phishing attempt. Do not click any links, download attachments, or reply.' },
        SUSPICIOUS: { emoji: '‚ö†Ô∏è', heading: 'Looks Suspicious', sub: 'Some signals raised red flags. Proceed with caution and verify directly with the sender through a trusted channel.' },
        SAFE: { emoji: '‚úÖ', heading: 'Looks Safe', sub: 'No threats detected across our intelligence databases. Stay vigilant ‚Äî when in doubt, always verify.' }
      };
      const c = map[v] || { emoji: '‚ùì', heading: 'Unknown', sub: 'We could not reach a clear verdict. Try again or add more email content.' };

      const box = document.getElementById('verdictBox');
      box.className = `verdict-box ${v}`;
      document.getElementById('verdictEmoji').textContent = c.emoji;
      document.getElementById('verdictHeading').textContent = c.heading;
      document.getElementById('verdictSub').textContent = c.sub;
      box.style.display = 'flex';

      const list = document.getElementById('checksList');
      list.innerHTML = '';

      data.checks.forEach(check => {
        const cv = check.verdict || 'UNKNOWN';
        const source = (check.source || 'Sender Analysis').replace(/_/g, ' ').toUpperCase();

        let detail = '';
        let subDetail = '';

        if (check.reason) {
          detail = check.reason;
          subDetail = 'Sender domain analysis';
        } else if (check.malicious !== undefined) {
          detail = check.target;
          subDetail = `${check.malicious} malicious ¬∑ ${check.suspicious} suspicious detections`;
        } else if (check.pulse_count !== undefined) {
          detail = check.target;
          subDetail = `${check.pulse_count} threat pulse${check.pulse_count !== 1 ? 's' : ''} found`;
        } else if (check.flagged_urls) {
          detail = `Flagged: ${check.flagged_urls.join(', ')}`;
          subDetail = 'Google Safe Browsing';
        } else {
          detail = check.target || 'No data returned';
          subDetail = 'No threats detected';
        }

        const item = document.createElement('div');
        item.className = 'check-item';
        item.innerHTML = `
          <div class="check-dot ${cv}"></div>
          <div class="check-text">
            ${detail}
            <small>${subDetail} ¬∑ ${source}</small>
          </div>
          <div class="check-badge ${cv}">${cv}</div>
        `;
        list.appendChild(item);
      });

      document.getElementById('breakdownCard').style.display = 'block';
    }

    function subscribe() {
      const email = document.getElementById('nlEmail').value.trim();
      const name = document.getElementById('nlName').value.trim();
      if (!email || !email.includes('@')) { alert('Please enter a valid email address.'); return; }
      console.log('Subscriber:', { name, email });
      document.getElementById('nlForm').style.display = 'none';
      document.getElementById('nlSuccess').classList.add('active');
    }
  </script>
</body>
</html>
